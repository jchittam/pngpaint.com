(function(t,e,i,a){"use strict";function s(e,a){this.element=e,this.$element=t(e),this.options=t.extend(!0,{},C,a),this.paginationContext=this.options.pagination&&this.options.pagination.generate?this.element:i,this.options.thumbnailSize||this.options.imageSize||this.options.setDefaultSize(),this.galleryId=this.element.id||Math.random().toString(36),this.page=1,this.init()}var o="json",n="flickr.photos.search",r="flickr.photosets.getPhotos",l="62525ee8c8d131d708d33d61f29434b6",h="data-tags",p="data-user-id",d="data-set-id",c="data-per-page",g="jsfg",u=1e4,m="modal-header",f="h3",v="modal-body",_="modal-image",b="modal-footer",x="jsFlickrGallery",C={fetchImages:!0,animation:"fade",animationSpeed:250,preload:{range:2},structure:{ulClass:".thumbnails",liClass:".span1",aClass:".thumbnail"},modal:{generate:!0,id:"jsfg-modal",title:"."+m+" "+f,imageContainerClass:"."+_,onContainerNext:!0,imageFadeTime:250,prevClass:".btn.modal-prev",nextClass:".btn.modal-next",prevText:"Previous image",nextText:"Next image",offsetWidth:100,offsetHeight:200},pagination:{generate:!0,containerClass:".pagination",prevClass:".btn.pagination-prev",nextClass:".btn.pagination-next",prevText:"Previous page",nextText:"Next page"},loader:{animation:!0,loaderClass:".jsfg-loader",text:"Loading",interval:200,mark:".",markClass:".animation-marks",maxMarks:3},url:{per_page:30,tag_mode:"all"},error:{text:"No photos found",tagClass:"error"},imageSizes:{square:"s",square_150:"q",thumb:"t",small:"m",small_320:"n",medium_640:"z",medium_800:"c",large:"b",largest:"h"},apiUrl:"https://api.flickr.com/services/rest/?jsoncallback=?",setDefaultSize:function(){this.thumbnailSize=this.imageSizes.small,this.imageSize=this.imageSizes.large}};s.prototype={init:function(){this.options.fetchImages?(this.options.loader&&(this.loaderInterval=this._createLoader(this.element)),this.createGallery()):this.anchors=this._getAnchors(),this.options.pagination&&this.options.fetchImages&&(this.options.pagination.generate&&this._createPagination(),this._bindPaginationEvents())},createGallery:function(t){return this.options.url.format=o,this.options.url.api_key=l,this.options.url.photoset_id=this.$element.attr(d)||this.options.url.photoset_id,this.options.url.photoset_id?(this.options.url.method=r,delete this.options.url.tag_mode):(this.options.url.method=n,delete this.options.url.photoset_id,this.options.url.tags=this.$element.attr(h)||this.options.url.tags,this.options.url.user_id=this.$element.attr(p)||this.options.url.user_id,this.options.url.user_id||delete this.options.url.user_id),this.options.url.page=this.page=t||this.page,this.options.url.per_page=this.$element.attr(c)||this.options.url.per_page,this._getPhotos(),this},clearGallery:function(e){function i(){s.options.loader&&(s.loaderInterval=s._createLoader(s.element)),e&&s.createGallery(e),a.remove()}var a=t(this.options.structure.ulClass,this.element),s=this;switch(this.options.animation){case"fade":a.fadeOut(this.options.animationSpeed,i);break;case"show":a.hide(this.options.animationSpeed,i);break;case!1:a.hide(0,i)}return this},isLastPage:function(){return!this.anchors||this.anchors.length<this.options.url.per_page},nextPage:function(){return!this.isLastPage()&&this.clearGallery(this.page+1)},prevPage:function(){return this.page>1&&this.clearGallery(this.page-1)},prevImage:function(){return this.index-=1,this.index<0&&(this.index=this.anchors.length-1),this._loadImage(!1)},nextImage:function(){return this.index+=1,this.index>this.anchors.length-1&&(this.index=0),this._loadImage(!1)},_getPhotos:function(){var e=this;t.ajax({type:"GET",url:e.options.apiUrl,data:e.options.url,dataType:"jsonp",timeout:u}).done(function(t){e._renderGalleryContent(t.photos||t.photoset)}).always(function(t,i){"timeout"===i&&e._getPhotos()})},_renderGalleryContent:function(e){var a,s,o,n,r,l=this,h="",p=0,d=(this._replaceDots(l.options.structure.liClass),this._replaceDots(l.options.structure.aClass));if(e.photo.length>0){s=t('<div class="thumbnails" id="myGallery" style="display: none">');for(var c=0;c<e.photo.length;c++)o="https://farm"+e.photo[c].farm+".static.flickr.com/"+e.photo[c].server+"/"+e.photo[c].id+"_"+e.photo[c].secret+"_",n=this._htmlEscape(e.photo[c].title),h+='<a href="'+o+'b.jpg" title="'+n+'" class="'+d+'"><img alt="'+n+'" src="'+o+'m.jpg"/></a>';l.element.insertBefore(s.append(h)[0],l.element.firstChild),a=s.find("img"),a.on("error",function(){var e=t(this),i=e.attr("src");e.attr("src",null).attr("src",i)}),a.on("load",function(){if(p++,p===e.photo.length){switch(l._removeLoader(l.element),l.options.animation){case"fade":s.fadeIn(l.options.animationSpeed);break;case"show":s.show(l.options.animationSpeed);break;case!1:s.show()}a.off("load").off("error"),l.anchors=l._getAnchors(),l._togglePagination(),t("#myGallery").justifiedGallery(),baguetteBox.run("#myGallery")}})}else r=i.createElement("span"),r.className=l.options.error.tagClass,r.innerHTML=l.options.error.text,l.element.insertBefore(r,l.element.firstChild),l._removeLoader(l.element)._togglePagination();return l},_createPagination:function(){var e="",i=t(this.options.pagination.prevClass,this.paginationContext)[0],a=t(this.options.pagination.nextClass,this.paginationContext)[0];return i||a||!this.options.pagination.generate||(e+='<div class="'+this._replaceDots(this.options.pagination.containerClass)+'"><button class="'+this._replaceDots(this.options.pagination.prevClass)+'" disabled="disabled">&laquo; '+this.options.pagination.prevText+'</button><button class="'+this._replaceDots(this.options.pagination.nextClass)+'" disabled="disabled">'+this.options.pagination.nextText+" &raquo;</button></div>",this.element.appendChild(t(e)[0])),this},_bindPaginationEvents:function(){var e=this,i=t(this.options.pagination.prevClass,this.paginationContext),a=t(this.options.pagination.nextClass,this.paginationContext);i.click(function(){i.is(":disabled")||(a.attr("disabled","disabled"),i.attr("disabled","disabled"),e.prevPage())}),a.click(function(){a.is(":disabled")||(i.attr("disabled","disabled"),a.attr("disabled","disabled"),e.nextPage())})},_togglePagination:function(){var e=t(this.options.pagination.prevClass,this.paginationContext),i=t(this.options.pagination.nextClass,this.paginationContext);return 1!==this.page?e.removeAttr("disabled"):e.attr("disabled","disabled"),this.isLastPage()?i.attr("disabled","disabled"):i.removeAttr("disabled"),this},_createModal:function(){var t,e,a,s;return i.getElementById(this.options.modal.id)||(t='<div class="'+m+'"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><'+f+"></"+f+"></div>",e='<div class="'+v+'"><div class="'+_+'"></div></div>',a='<div class="'+b+'"><button title="'+this.options.modal.prevText+'" class="'+this._replaceDots(this.options.modal.prevClass)+'">&laquo;</button><button title="'+this.options.modal.nextText+'" class="'+this._replaceDots(this.options.modal.nextClass)+'">&raquo;</button></div>',s=i.createElement("div"),s.id=this.options.modal.id,s.className="modal jsfg-modal hide fade",s.innerHTML=t+e+a,i.body.appendChild(s)),this},_preloadImages:function(){var e,a,s,o=this.index+this.options.preload.range+1,n=this.index-this.options.preload.range;for(o=o>this.anchors.length?o-this.anchors.length:o,n=n>o?n-this.anchors.length:n,a=n;a<o;a++)s=a<0?this.anchors.length+a:a,e=this.anchors[s],e&&s!==this.index&&t(i.createElement("img")).attr("src",e.href||t(e).attr("href"));return this},_resizeToFit:function(t,e){var i,a,s=1,o=t.prop("width"),n=t.prop("height");return i=e.width()-this.options.modal.offsetWidth,a=e.height()-this.options.modal.offsetHeight,(o>i||n>a)&&(s=Math.min(i/o,a/n)),t.prop("width",o*s).prop("height",n*s),t},_createLoader:function(t){var e=i.createElement("span"),a=i.createElement("p"),s=this.options;return a.appendChild(i.createTextNode(s.loader.text)),a.className=this._replaceDots(s.loader.loaderClass),e.className=this._replaceDots(s.loader.markClass),t.insertBefore(a.appendChild(e).parentNode,t.firstChild),!s.loader.animation||setInterval(function(){e.innerHTML.length<=s.loader.maxMarks?e.innerHTML+=s.loader.mark:e.innerHTML=""},s.loader.interval)},_getAnchors:function(){return t(this.options.structure.aClass,this.element).get()},_removeLoader:function(e){var i=t(this.options.loader.loaderClass,e)[0];return this.loaderInterval&&i&&(e.removeChild(i),clearInterval(this.loaderInterval)),this},_htmlEscape:function(t){return t.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},_replaceDots:function(t){return t.replace(/\./g," ")}},t.fn[x]=function(e){return this.each(function(){t.data(this,"plugin_"+x)||t.data(this,"plugin_"+x,new s(this,e))})},t(function(){t('[data-toggle="'+g+'"]').jsFlickrGallery()})})(jQuery,window,document);